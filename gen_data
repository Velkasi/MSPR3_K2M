import random
import pandas as pd
from faker import Faker
from datetime import timedelta

fake = Faker('fr_FR')

# Génère T_PERSONNE_2
def generate_personnes(nb):
    return pd.DataFrame([{
        "Nom": fake.last_name(),
        "Prenom": fake.first_name()
    } for _ in range(nb)])

# Génère T_ADRESSE_2
def generate_adresses(nb):
    return pd.DataFrame([{
        "Voie": fake.street_name(),
        "N_Voie": fake.building_number(),
        "CP": fake.postcode(),
        "Ville": fake.city()
    } for _ in range(nb)])

# Génère T_TECHNICIEN_2
def generate_techniciens(nb):
    return pd.DataFrame([{
        "Nom_technicien": fake.last_name(),
        "Prenom_technicien": fake.first_name()
    } for _ in range(nb)])

# Génère T_TYPE_OS_2
def generate_type_os(nb):
    return pd.DataFrame([{
        "Type_d_OS": random.choice(["Windows", "Linux", "macOS"]),
        "Version_OS": f"{random.randint(1, 11)}.{random.randint(0, 9)}"
    } for _ in range(nb)])

# Génère T_PRESTATAIRE_2
def generate_prestataires(nb, personne_ids, adresse_ids):
    return pd.DataFrame([{
        "Id_Personne": random.choice(personne_ids),
        "Nom_societe": fake.company(),
        "SIRET": fake.random_number(digits=14, fix_len=True),
        "Id_ADRESSE": random.choice(adresse_ids)
    } for _ in range(nb)])

# Génère T_CONTRAT_2
def generate_contrats(nb, prestataires_ids):
    return pd.DataFrame([{
        "Duree_contrat": f"{random.randint(6, 36)} mois",
        "Id_Date_contrat": fake.date_between(start_date='-2y', end_date='today'),
        "Id_Personne": random.choice(prestataires_ids)
    } for _ in range(nb)])

# Génère TJ_recupere_2
def generate_recuperations(nb, instance_ids, personne_ids):
    return pd.DataFrame([{
        "Id_INSTANCE": random.choice(instance_ids),
        "Id_Personne": random.choice(personne_ids),
        "Id_Date_collecte": fake.date_between(start_date='-1y', end_date='today')
    } for _ in range(nb)])

# Génération
df_personnes = generate_personnes(100)
df_adresses = generate_adresses(50)
df_techniciens = generate_techniciens(20)
df_os = generate_type_os(10)

df_personnes.to_csv("core_2.T_PERSONNE_2.csv", index=False)
df_adresses.to_csv("core_2.T_ADRESSE_2.csv", index=False)
df_techniciens.to_csv("core_2.T_TECHNICIEN_2.csv", index=False)
df_os.to_csv("core_2.T_TYPE_OS_2.csv", index=False)

personne_ids = list(range(1, 101))
adresse_ids = list(range(1, 51))
instance_ids = list(range(1, 51))

df_prestataires = generate_prestataires(30, personne_ids, adresse_ids)
prestataire_ids = df_prestataires["Id_Personne"].tolist()
df_contrats = generate_contrats(50, prestataire_ids)
df_recup = generate_recuperations(100, instance_ids, personne_ids)

df_prestataires.to_csv("client_a_2.T_PRESTATAIRE_2.csv", index=False)
df_contrats.to_csv("client_a_2.T_CONTRAT_2.csv", index=False)
df_recup.to_csv("client_a_2.TJ_recupere_2.csv", index=False)

print("Toutes les données ont été générées.")
